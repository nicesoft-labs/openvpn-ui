{{ template "layout/base.html" . }}

{{define "head"}}
<title>Переменные EasyRSA</title>
{{end}}

{{define "body"}}
<div class="card card-default">
  <div class="card-header with-border">
    <h3 class="card-title">Конфигурация Vars</h3>
    <div class="pull-right card-tools">
      <button type="button" class="btn btn-tool" data-card-widget="collapse">
        <i class="fa fa-minus"></i></button>
    </div>
  </div>
  <div class="card-body">
    <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false" class="collapsed">
      <i class="fa fa-fw fa-info-circle" style="font-size: 15px;"></i> Обратите внимание
    </a>
    <div class="card-group" id="accordion">
    </div>
    <div id="collapseOne" class="panel-collapse collapse" aria-expanded="false" style="height: 0px;">
      <span class="text-muted">Если вы уже выполнили автоматическую настройку без изменения переменных EasyRSA и теперь хотите внести правки, выполните следующие шаги:</span><br>
      <span class="text-muted"><b style="visibility: hidden;">Note</b>1. Сохраните новые переменные EasyRSA на этой странице.</span><br>
      <span class="text-muted"><b style="visibility: hidden;">Note</b>2. Перейдите в раздел &quot;Configuration &gt; Maintenance&quot;.</span><br>
      <span class="text-muted"><b style="visibility: hidden;">Note</b>3. Нажмите кнопку &quot;DELETE ALL&quot;, затем кнопку &quot;INITIALIZE ALL&quot;.</span>
    </div>

      <!-- /.card-header -->
      <!-- form start -->
      {{template "common/alert.html" .}}
      <form role="form" action="{{urlfor "EasyRSAConfigController.Post"}}" method="post">

        <span>Справочник по переменным EasyRSA с описанием каждого параметра доступен<a href="https://github.com/OpenVPN/easy-rsa/blob/master/doc/EasyRSA-Advanced.md#environmental-variables-reference" target="_blank"> здесь</a>.</span><br><br>
          <!-- Disabled Profile - yet another feature to implement.
          <div class="form-group">
            <label for="name">Profile</label>
            <input type="text" class="form-control" name="Profile" id="Profile" value="{{ .Settings.Profile }}" style="visibility: hidden;" disabled>
          </div> -->
      <div class="form-group">
        <label for="name">EASYRSA_DN</label>
        <input type="text" class="form-control" id="EasyRSADN" name="EasyRSADN" placeholder="org"
          value="{{ .Settings.EasyRSADN }}">
          <span id="helpBlock" class="text-muted">&quot;org&quot; — полный формат DN: &quot;Country/Province/City/Org/Org.Unit/email/commonName&quot;. &quot;cn_only&quot; — использовать только значение commonName.</span>
      </div>

      <div class="form-group">
        <label for="name">EASYRSA_REQ_COUNTRY</label>
        <input type="text" class="form-control" id="EasyRSAReqCountry" name="EasyRSAReqCountry" placeholder="UA"
          value="{{ .Settings.EasyRSAReqCountry }}">
          <span id="helpBlock" class="text-muted">Двубуквенное поле DN для кода страны (например, UA).</span>
      </div>

      <div class="form-group">
        <label for="name">EASYRSA_REQ_PROVINCE</label>
        <input type="text" class="form-control" id="EasyRSAReqProvince" name="EasyRSAReqProvince" placeholder="KY"
          value="{{ .Settings.EasyRSAReqProvince }}">
        <span id="helpBlock" class="text-muted">Двубуквенное поле DN для кода региона/штата (например, KY для &quot;Kyiv region&quot;).</span>
      </div>

      <div class="form-group">
        <label for="name">EASYRSA_REQ_CITY</label>
        <input type="text" class="form-control" id="EasyRSAReqCity" name="EasyRSAReqCity" placeholder="Kyiv"
          value="{{ .Settings.EasyRSAReqCity }}">
        <span id="helpBlock" class="text-muted">Город в DN организации.</span>

      </div>

      <div class="form-group">
        <label for="name">EASYRSA_REQ_ORG</label>
        <input type="text" class="form-control" id="EasyRSAReqOrg" name="EasyRSAReqOrg" placeholder="SweetHome"
          value="{{ .Settings.EasyRSAReqOrg }}">
        <span id="helpBlock" class="text-muted">Название организации в DN.</span>
      </div>

      <div class="form-group">
        <label for="name">EASYRSA_REQ_EMAIL</label>
        <input type="text" class="form-control" id="EasyRSAReqEmail" name="EasyRSAReqEmail" placeholder="sweet@home.ua"
          value="{{ .Settings.EasyRSAReqEmail }}">
        <span id="helpBlock" class="text-muted">Адрес электронной почты организации в DN.</span>
      </div>

      <div class="form-group">
        <label for="name">EASYRSA_REQ_OU</label>
        <input type="text" class="form-control" id="EasyRSAReqOu" name="EasyRSAReqOu" placeholder="GarageVPN"
          value="{{ .Settings.EasyRSAReqOu }}">
        <span id="helpBlock" class="text-muted">Организационное подразделение (OU) в DN.</span>
      </div>

      <div class="form-group">
        <label for="name">EASYRSA_REQ_CN</label>
        <input type="text" class="form-control" id="EasyRSAReqCn" name="EasyRSAReqCn" placeholder="OVPNserver"
          value="{{ .Settings.EasyRSAReqCn }}">
        <span id="helpBlock" class="text-muted">Общее имя (Common Name) в DN.</span>
      </div>

      <div class="form-group">
        <label for="name">EASYRSA_KEY_SIZE</label>
        <input type="text" class="form-control" id="EasyRSAKeySize" name="EasyRSAKeySize" placeholder="2048"
          value="{{ .Settings.EasyRSAKeySize }}">
        <span id="helpBlock" class="text-muted">Размер ключевых пар в битах. Рекомендуемое значение — 2048; можно увеличить до 4096.</span>
      </div>

      <div class="form-group">
        <label for="name">EASYRSA_CA_EXPIRE</label>
        <input type="text" class="form-control" id="EasyRSACaExpire" name="EasyRSACaExpire" placeholder="3650"
          value="{{ .Settings.EasyRSACaExpire }}">
        <span id="helpBlock" class="text-muted">Количество дней до истечения срока действия корневого ключа CA. Рекомендуемое значение — 3650.</span>
      </div>

      <div class="form-group">
        <label for="name">EASYRSA_CERT_EXPIRE</label>
        <input type="text" class="form-control" id="EasyRSACertExpire" name="EasyRSACertExpire" placeholder="825"
          value="{{ .Settings.EasyRSACertExpire }}">
        <span id="helpBlock" class="text-muted">Количество дней до истечения срока действия клиентского сертификата. Рекомендуемое значение — 825.</span>
      </div>

      <div class="form-group">
        <label for="name">EASYRSA_CRL_DAYS</label>
        <input type="text" class="form-control" id="EasyRSACrlDays" name="EasyRSACrlDays" placeholder="180"
          value="{{ .Settings.EasyRSACrlDays }}">
        <span id="helpBlock" class="text-muted">Количество дней до истечения срока действия CRL. Рекомендуемое значение — 180. Чтобы применить новое значение, нажмите &quot;Generate CRL&quot; в разделе &quot;Maintenance&quot;.</span>
      </div>

      <div class="form-group">
        <label for="name">EASYRSA_CERT_RENEW</label>
        <input type="text" class="form-control" id="EasyRSACertRenew" name="EasyRSACertRenew" placeholder="30"
          value="{{ .Settings.EasyRSACertRenew }}">
        <span id="helpBlock" class="text-muted">Должно быть реализовано на стороне сервера OpenVPN. Количество дней до истечения, за которое сертификаты будут автоматически продлеваться.</span>
      </div>

      {{ .xsrfdata }}

      <button type="submit" style="width: 145px;" class="btn btn-primary">Сохранить Vars</button> &nbsp; &nbsp;
      <button type="button" style="width: 145px;" class="btn btn-primary" data-toggle="modal" data-target="#easyrsa-view-modal">Просмотреть Vars</button>
    </div>
        <!-- /.card-body -->
  </form>

</div>

<div class="modal fade" id="easyrsa-view-modal">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Просмотр конфигурации</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Закрыть">
          <span aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-body">
           <!-- /.card-header -->
            <!-- form start -->
           {{template "common/alert.html" .}}
            <form role="form" method="post">
              <div class="card-body">
              
                <div class="form-group">
                  <label for="name">.easy-rsa/pki/vars</label>
                  <textarea type="text" class="form-control my-textarea" name="ServerConfig" 
                   id="ServerConfig"  spellcheck="false" rows="15">{{ .EasyRSAConf }}</textarea>
                  <span id="helpBlock" class="text-muted">Это файл переменных EasyRSA (VARS).
                  </span>
                </div>
                
                {{ .xsrfdata }}

                <button type="button" class="btn btn-default pull-left" style="width: 145px;" data-dismiss="modal">Закрыть</button>
              </div>
                 <!-- /.card-body -->
            </form>
            <span class="text-muted"> {{template "common/fvalid.html" field_error_message .validation "Name" }}</span>
      </div>
    </div>
  </div>
</div>

<!-- /.card -->
{{end}}

<script>
  // Проверка темы в localStorage
  if (localStorage.getItem("theme") === "dark") {
    createEditor("EasyRSAConfig", "600px", "clouds_midnight", "ovpn", true);
  } else {
    createEditor("EasyRSAConfig", "600px", "clouds", "ovpn", true);
  }
</script>
